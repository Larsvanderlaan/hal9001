<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fitting the Highly Adaptive Lasso with `hal9001` • hal9001</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Fitting the Highly Adaptive Lasso with `hal9001`">
<meta property="og:description" content="hal9001">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-115145808-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-115145808-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">hal9001</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.7</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="https://tlverse.org">tlverse</a>
</li>
<li>
  <a href="../articles/intro_hal9001.html">Overview</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/tlverse/hal9001">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Fitting the Highly Adaptive Lasso with <code>hal9001</code>
</h1>
                        <h4 class="author">
<a href="https://nimahejazi.org">Nima Hejazi</a> and <a href="https://github.com/jeremyrcoyle">Jeremy Coyle</a>
</h4>
            
            <h4 class="date">2020-09-26</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/tlverse/hal9001/blob/master/vignettes/intro_hal9001.Rmd"><code>vignettes/intro_hal9001.Rmd</code></a></small>
      <div class="hidden name"><code>intro_hal9001.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>The <em>highly adaptive Lasso</em> (HAL) is a flexible machine learning algorithm that nonparametrically estimates a function based on available data by embedding a set of input observations and covariates in an extremely high-dimensional space (i.e., generating basis functions from the available data). For an input data matrix of <span class="math inline">\(n\)</span> observations and <span class="math inline">\(d\)</span> covariates, the number of basis functions generated is approximately <span class="math inline">\(n \cdot 2^{d - 1}\)</span>. To select a set of basis functions from among the full set generated, the Lasso is employed. The <code>hal9001</code> R package provides an efficient implementation of this routine, relying on the <code>glmnet</code> R package for compatibility with the canonical Lasso implementation while still providing a (faster) custom C++ routine for using the Lasso with an input matrix composed of indicator functions. Consider consulting <span class="citation">Benkeser and van der Laan (2016)</span>, <span class="citation">(<span class="citeproc-not-found" data-reference-id="vdl2015generally"><strong>???</strong></span>)</span>, <span class="citation">van der Laan (2017)</span> for detailed theoretical descriptions of the highly adaptive Lasso and its various optimality properties.</p>
<hr>
</div>
<div id="preliminaries" class="section level2">
<h2 class="hasAnchor">
<a href="#preliminaries" class="anchor"></a>Preliminaries</h2>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="co"># simulation constants</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">467392</span>)
<span class="kw">n_obs</span> <span class="op">&lt;-</span> <span class="fl">200</span>
<span class="kw">n_covars</span> <span class="op">&lt;-</span> <span class="fl">3</span>

<span class="co"># make some training data</span>
<span class="kw">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">replicate</a></span>(<span class="kw">n_covars</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="kw">n_obs</span>))
<span class="kw">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span>(<span class="kw">x</span>[, <span class="fl">1</span>]) <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span>(<span class="kw">x</span>[, <span class="fl">2</span>]) <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="kw">n_obs</span>, mean = <span class="fl">0</span>, sd = <span class="fl">0.2</span>)

<span class="co"># make some testing data</span>
<span class="kw">test_x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">replicate</a></span>(<span class="kw">n_covars</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="kw">n_obs</span>))
<span class="kw">test_y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span>(<span class="kw">x</span>[, <span class="fl">1</span>]) <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span>(<span class="kw">x</span>[, <span class="fl">2</span>]) <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="kw">n_obs</span>, mean = <span class="fl">0</span>, sd = <span class="fl">0.2</span>)
</pre></div>
<p>Let’s look at simulated data:</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="kw">x</span>)
</pre></div>
<pre><code>##             [,1]       [,2]       [,3]
## [1,]  2.44102981 -0.6441252 -0.4632021
## [2,] -1.21932335 -0.9481608  2.6358511
## [3,] -0.40613567  0.4337314 -0.2226760
## [4,] -1.09760477 -1.5845711 -1.0496038
## [5,]  0.23710498  0.1261754  1.4717507
## [6,]  0.06810091 -0.2623992 -0.7534596</code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="kw">y</span>)
</pre></div>
<pre><code>## [1]  0.31596199 -1.74749349 -0.08198272 -2.13963686  0.42902938 -0.12824651</code></pre>
<hr>
</div>
<div id="using-the-highly-adaptive-lasso" class="section level2">
<h2 class="hasAnchor">
<a href="#using-the-highly-adaptive-lasso" class="anchor"></a>Using the Highly Adaptive Lasso</h2>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://github.com/tlverse/hal9001">hal9001</a></span>)
</pre></div>
<pre><code>## Loading required package: Rcpp</code></pre>
<pre><code>## hal9001 v0.2.7: The Scalable Highly Adaptive Lasso</code></pre>
<!-- ### Fitting the HAL model: "lassi" -->
<!-- Our custom implementation of the Lasso has been dubbed _lassi_. For the purposes -->
<!-- of HAL, it is faster than using the standard `glmnet` approach, but it is not -->
<!-- yet available for generalized linear models (i.e., iteratively re-weighted least -->
<!-- squares has not yet been implemented). -->
<!-- ```{r fit-hal-lassi} -->
<!-- hal_fit1 <- fit_hal(X = x, Y = y, fit_type = "lassi") -->
<!-- hal_fit1$times -->
<!-- ``` -->
<!-- ```{r results-hal-lassi} -->
<!-- hal_fit1 -->
<!-- ``` -->
<div id="fitting-the-model-glmnet" class="section level3">
<h3 class="hasAnchor">
<a href="#fitting-the-model-glmnet" class="anchor"></a>Fitting the model: <code>glmnet</code>
</h3>
<p>HAL uses the popular <code>glmnet</code> R package for the lasso step:</p>
<div class="sourceCode" id="cb9"><pre class="downlit">
<span class="kw">hal_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_hal.html">fit_hal</a></span>(X = <span class="kw">x</span>, Y = <span class="kw">y</span>, fit_type = <span class="st">"glmnet"</span>)
</pre></div>
<pre><code>## [1] "Without your space helmet, Dave. You're going to find that rather difficult."</code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit">
<span class="kw">hal_fit</span><span class="op">$</span><span class="kw">times</span>
</pre></div>
<pre><code>##                   user.self sys.self elapsed user.child sys.child
## enumerate_basis       0.005    0.001   0.005          0         0
## design_matrix         0.018    0.000   0.018          0         0
## reduce_basis          0.000    0.000   0.000          0         0
## remove_duplicates     0.009    0.000   0.009          0         0
## lasso                 0.696    0.011   0.709          0         0
## total                 0.729    0.012   0.742          0         0</code></pre>
<p>While the raw output object may be examined, it has (usually large) slots that make quick examination challenging. Instead, we recommend the <code>summary</code> method, which provides an interpretable table of basis functions with non-zero coefficients.</p>
<div class="sourceCode" id="cb13"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="kw">hal_fit</span>)<span class="op">$</span><span class="kw">table</span>
</pre></div>
<pre><code>##              coef
##  1: -7.812231e-01
##  2:  1.968808e-01
##  3:  1.632766e-01
##  4:  1.483639e-01
##  5:  1.462592e-01
##  6:  1.456650e-01
##  7:  1.441887e-01
##  8:  1.367758e-01
##  9:  1.348308e-01
## 10:  1.324568e-01
## 11:  1.247913e-01
## 12:  1.171875e-01
## 13:  1.146518e-01
## 14:  1.125166e-01
## 15:  1.120689e-01
## 16:  1.098491e-01
## 17:  1.038959e-01
## 18:  1.000336e-01
## 19:  8.276983e-02
## 20:  7.750062e-02
## 21:  7.317027e-02
## 22:  7.296611e-02
## 23:  6.535017e-02
## 24:  6.344607e-02
## 25:  6.300968e-02
## 26:  5.772281e-02
## 27:  5.638586e-02
## 28:  5.585372e-02
## 29:  5.433344e-02
## 30:  5.086507e-02
## 31:  5.041330e-02
## 32:  4.925794e-02
## 33:  4.846195e-02
## 34:  4.137366e-02
## 35:  3.869325e-02
## 36:  3.812788e-02
## 37:  3.652213e-02
## 38:  3.631055e-02
## 39:  3.597019e-02
## 40:  3.377831e-02
## 41:  3.351076e-02
## 42:  2.921166e-02
## 43:  2.851651e-02
## 44:  2.676665e-02
## 45:  2.459752e-02
## 46:  2.402039e-02
## 47:  2.344251e-02
## 48:  2.154657e-02
## 49:  1.971008e-02
## 50:  1.873740e-02
## 51:  1.842638e-02
## 52:  1.760974e-02
## 53:  1.755002e-02
## 54:  1.557752e-02
## 55:  1.429619e-02
## 56:  1.267729e-02
## 57:  1.142536e-02
## 58:  7.771376e-03
## 59:  3.178810e-03
## 60:  2.607689e-03
## 61:  2.534992e-03
## 62:  1.790010e-03
## 63:  1.617822e-03
## 64:  1.424163e-03
## 65:  2.166444e-04
## 66:  8.432367e-05
## 67: -8.648258e-05
## 68: -2.281031e-03
## 69: -7.607974e-03
## 70: -2.909367e-02
## 71: -3.439369e-02
## 72: -3.944700e-02
## 73: -4.035840e-02
## 74: -9.726592e-02
## 75: -1.056429e-01
## 76: -1.466408e-01
## 77: -2.054773e-01
## 78: -7.314642e-01
##              coef
##                                                                                                                                                                                                                                                                                                                                                                                                   term
##  1:                                                                                                                                                                                                                                                                                                                                                                                          Intercept
##  2:                                                                                                                                                                                                                                                                                                                                                                                    I(1 &gt;= -0.1725)
##  3:                                                                                                                                                                                                                                                                                                                                                                                     I(1 &gt;= 0.3807)
##  4:                                                                                                                                                                                                                                                                                                                                                                                      I(2 &gt;= 0.119)
##  5:                                                                                                                                                                                                                                                                                                                                                                                    I(1 &gt;= -0.5685)
##  6:                                                                                                                                                                                                                                                                                                                                                                                    I(2 &gt;= -0.1015)
##  7:                                                                                                                                                                                                                                                                                                                                                                                     I(1 &gt;= 0.1386)
##  8:                                                                                                                                                                                                                                                                                                                                                                                     I(2 &gt;= 1.0291)
##  9:                                                                                                                                                                                                                                                                                                                                                                                    I(2 &gt;= -0.6441)
## 10:                                                                                                                                                                                                                                                                                                                                                                                     I(2 &gt;= 0.6786)
## 11:                                                                                                                                                                                                                                                                                                                                                                      I(2 &gt;= 1.3571)*I(3 &gt;= 1.4599)
## 12:                                                                                                                                                                                                                                                                                                                                                                                     I(1 &gt;= 0.4752)
## 13:                                                                                                                                                                                                                                                                                                                                                                                    I(2 &gt;= -0.9482)
## 14:                                                                                                                                                                                                                                                                                                                                                                                    I(1 &gt;= -0.5113)
## 15:                                                                                                                                                                                                                                                                                                                                                                                    I(2 &gt;= -0.1938)
## 16:                                                                                                                                                                                                                                                                                                                                                                                     I(2 &gt;= -0.782)
## 17:                                                                                                                                                                                                                                                                                                                                                                                    I(2 &gt;= -0.9921)
## 18:                                                                                                                                                                                                                                                                                                                                                                     I(1 &gt;= 0.8989)*I(3 &gt;= -1.0482)
## 19:                                                                                                                                                                                                                                                                                                                                                                                     I(2 &gt;= -0.313)
## 20:                                                                                                                                                                                                                                                                                                                                                                      I(1 &gt;= 0.0911)*I(2 &gt;= 0.3539)
## 21:                                                                                                                                                                                                                                                                                                                                                                                     I(1 &gt;= 0.0345)
## 22:                                                                                                                                                                                                                                                                                                                                                                      I(1 &gt;= 0.0855)*I(2 &gt;= 0.4067)
## 23:                                                                                                                                                                                                                                                                                                                                                                                    I(1 &gt;= -0.2045)
## 24:                                                                                                                                                                                                                                                                                                                                                                                      I(1 &gt;= 0.634)
## 25:                                                                                                                                                                                                                                                                                                                                                                                    I(2 &gt;= -0.6718)
## 26:                                                                                                                                                                                                                                                                                                                                                                                     I(2 &gt;= 0.6959)
## 27:                                                                                                                                                                                                                                                                                                                                                                                    I(1 &gt;= -0.4061)
## 28:                                                                                                                                                                                                                                                                                                                                                       I(1 &gt;= 1.182)*I(2 &gt;= 0.5866)*I(3 &gt;= -0.5114)
## 29:                                                                                                                                                                                                                                                                                                                                                                                    I(1 &gt;= -0.8398)
## 30:                                                                                                                                                                                                                                                                                                                                                                                     I(2 &gt;= 0.1844)
## 31:                                                                                                                                                                                                                                                                                                                                                                                      I(1 &gt;= 0.747)
## 32:                                                                                                                                                                                                                                                                                                                                                                                     I(1 &gt;= -0.908)
## 33:                                                                                                                                                                                                                                                                                                                                                                                     I(2 &gt;= 0.3545)
## 34:                                                                                                                                                                                                                                                                                                                                                                    I(1 &gt;= -0.1378)*I(3 &gt;= -1.5644)
## 35:                                                                                                                                                                                                                                                                                                                                                                     I(2 &gt;= 0.6488)*I(3 &gt;= -1.0124)
## 36:                                                                                                                                                                                                                                                                                                                                                                                    I(2 &gt;= -0.7863)
## 37:                                                                                                                                                                                                                                                                                                                                                                     I(2 &gt;= 1.2184)*I(3 &gt;= -0.6318)
## 38:                                                                                                                                                                                                                                                                                                                                                                                     I(2 &gt;= 0.0232)
## 39:                                                                                                                                                                                                                                                                                                                                                                                     I(2 &gt;= 0.2092)
## 40:                                                                                                                                                                                                                                                                                                                                                                                     I(2 &gt;= 0.4512)
## 41:                                                                                                                                                                                                                                                                                                                                                                                     I(2 &gt;= 0.2844)
## 42:                                                                                                                                                                                                                                                                                                                                                                                    I(1 &gt;= -0.4766)
## 43:                                                                                                                                                                                                                                                                                                                                                                                     I(2 &gt;= 0.8281)
## 44:                                                                                                                                                                                                                                                                                                                                                                      I(2 &gt;= 0.1737)*I(3 &gt;= 1.8577)
## 45:                                                                                                                                                                                                                                                                                                                                                                     I(1 &gt;= 1.1353)*I(3 &gt;= -1.0124)
## 46:                                                                                                                                                                                                                                                                                                                                                                                    I(2 &gt;= -1.2687)
## 47:                                                                                                                                                                                                                                                                                                                                                                       I(1 &gt;= 0.747)*I(3 &gt;= -1.753)
## 48:                                                                                                                                                                                                                                                                                                                                                                                     I(2 &gt;= 0.1737)
## 49:                                                                                                                                                                                                                                                                                                                                                                     I(1 &gt;= -0.3937)*I(2 &gt;= -0.782)
## 50:                                                                                                                                                                                                                                                                                                                                                                                     I(1 &gt;= 0.3645)
## 51:                                                                                                                                                                                                                                                                                                                   I(1 &gt;= 1.2006)*I(3 &gt;= -1.011)  OR  I(1 &gt;= 1.2006)*I(2 &gt;= -1.1474)*I(3 &gt;= -1.011)
## 52:                                                                                                                                                                                                                                                                                                                                                                     I(1 &gt;= -0.8452)*I(3 &gt;= -0.628)
## 53:                                                                                                                                                                                                                                                                                                                                                                                    I(1 &gt;= -0.3879)
## 54:                                                                                                                                                                                                                                                                                                                                                                      I(1 &gt;= 0.1485)*I(2 &gt;= 0.9348)
## 55:                                                                                                                                                                                                                                                                                                                                                     I(1 &gt;= 1.2523)*I(2 &gt;= -0.0958)*I(3 &gt;= -0.6158)
## 56:                                                                                                                                                                                                                                                                                                                                                                                    I(2 &gt;= -0.3809)
## 57:                                                                                                                                                                                                                                                                                                                                                                                     I(2 &gt;= 0.0444)
## 58:                                                                                                                                                                                                                                                                                                                                                                                     I(2 &gt;= 0.3237)
## 59:                                                                                                                                                                                                                                                                                                                                                                                     I(1 &gt;= 0.1302)
## 60:                                                                                                                                                                                                                                                                                                                                                       I(1 &gt;= 0.747)*I(2 &gt;= -0.1954)*I(3 &gt;= -1.753)
## 61:                                                                                                                                                                                                                                                                                                                                                                                     I(1 &gt;= 0.1921)
## 62:                                                                                                                                                                                                                                                                                                                                                                                      I(2 &gt;= 0.738)
## 63:                                                                                                                                                                                                                                                                                                                                                                      I(1 &gt;= 0.634)*I(3 &gt;= -0.8881)
## 64:                                                                                                                                                                                                                                                                                                                                                                    I(1 &gt;= -0.8398)*I(3 &gt;= -1.5209)
## 65:                                                                                                                                                                                                                                                                                                                                                                                    I(1 &gt;= -0.3937)
## 66:                                                                                                                                                                                                                                                                                                                                                                                    I(1 &gt;= -0.4836)
## 67:                                                                                                                                                                                                                                                                                                                                                                     I(2 &gt;= -2.1625)*I(3 &gt;= 0.3336)
## 68:                                                                                                                                                                                                                                                                                                                                                                     I(1 &gt;= -0.7038)*I(3 &gt;= 0.3925)
## 69:                                                                                                                                                                                                                                                                                                                                                                                    I(2 &gt;= -2.1828)
## 70:                                                                                                                                                                                                                                                                                                   I(1 &gt;= 1.7813)*I(2 &gt;= 0.4792)*I(3 &gt;= -0.9682)  OR  I(1 &gt;= 2.0998)*I(2 &gt;= 0.3074)*I(3 &gt;= -1.3211)
## 71: I(1 &gt;= 1.8165)*I(3 &gt;= 0.7568)  OR  I(1 &gt;= 1.8717)*I(3 &gt;= 0.4161)  OR  I(1 &gt;= 1.9814)*I(3 &gt;= 0.0149)  OR  I(1 &gt;= 2.2918)*I(3 &gt;= 0.0013)  OR  I(1 &gt;= 1.5647)*I(2 &gt;= 1.3684)*I(3 &gt;= 0.3794)  OR  I(1 &gt;= 1.8165)*I(2 &gt;= 0.3545)*I(3 &gt;= 0.7568)  OR  I(1 &gt;= 1.8717)*I(2 &gt;= 0.2858)*I(3 &gt;= 0.4161)  OR  I(1 &gt;= 1.9814)*I(2 &gt;= -0.7717)*I(3 &gt;= 0.0149)  OR  I(1 &gt;= 2.2918)*I(2 &gt;= -1.0968)*I(3 &gt;= 0.0013)
## 72:                                                                                                                                                                                                                                                                                                                                                                     I(1 &gt;= -2.1579)*I(3 &gt;= 0.3054)
## 73:                                                                                                                                                                                                                                                                                                                                                                     I(1 &gt;= -2.3015)*I(2 &gt;= 2.1782)
## 74:                                                                                                                                                                                                                                                                                                                                                                                     I(2 &gt;= 2.0022)
## 75:                                                                                                                                                                                                                                                                                                                                                                                     I(2 &gt;= 2.1818)
## 76:                                                                                                                                                                                                                                                             I(1 &gt;= 2.441)  OR  I(1 &gt;= 2.441)*I(2 &gt;= -0.6441)  OR  I(1 &gt;= 2.441)*I(3 &gt;= -0.4632)  OR  I(1 &gt;= 2.441)*I(2 &gt;= -0.6441)*I(3 &gt;= -0.4632)
## 77:                                                                                                                                                                                                                                                                                                                                                                                    I(2 &gt;= -2.3508)
## 78:                                                                                                                                                                                                                                                                                                                                                                                    I(1 &gt;= -3.0511)
##                                                                                                                                                                                                                                                                                                                                                                                                   term</code></pre>
</div>
<div id="reducing-basis-functions" class="section level3">
<h3 class="hasAnchor">
<a href="#reducing-basis-functions" class="anchor"></a>Reducing basis functions</h3>
<p>As described in <span class="citation">Benkeser and van der Laan (2016)</span>, the HAL algorithm operates by first constructing a set of basis functions and subsequently fitting a Lasso model with this set of basis functions as the design matrix. Several approaches are considered for reducing this set of basis functions: 1. Removing duplicated basis functions (done by default in the <code>fit_hal</code> function), 2. Removing basis functions that correspond to only a small set of observations; a good rule of thumb is to scale with <span class="math inline">\(\frac{1}{\sqrt{n}}\)</span>.</p>
<p>The second of these two options may be invoked by specifying the <code>reduce_basis</code> argument to the <code>fit_hal</code> function:</p>
<div class="sourceCode" id="cb15"><pre class="downlit">
<span class="kw">hal_fit_reduced</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_hal.html">fit_hal</a></span>(X = <span class="kw">x</span>, Y = <span class="kw">y</span>, fit_type = <span class="st">"glmnet"</span>,
                           reduce_basis = <span class="fl">1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="kw">y</span>)))
</pre></div>
<pre><code>## [1] "Dave, although you took very thorough precautions in the pod against my hearing you, I could see your lips move."</code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit">
<span class="kw">hal_fit_reduced</span><span class="op">$</span><span class="kw">times</span>
</pre></div>
<pre><code>##                   user.self sys.self elapsed user.child sys.child
## enumerate_basis       0.002    0.001   0.003          0         0
## design_matrix         0.016    0.000   0.015          0         0
## reduce_basis          0.004    0.000   0.004          0         0
## remove_duplicates     0.005    0.000   0.006          0         0
## lasso                 0.634    0.003   0.639          0         0
## total                 0.662    0.004   0.667          0         0</code></pre>
<p>In the above, all basis functions with fewer than 7.0710678% of observations meeting the criterion imposed are automatically removed prior to the Lasso step of fitting the HAL regression. The results appear below</p>
<div class="sourceCode" id="cb19"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="kw">hal_fit_reduced</span>)<span class="op">$</span><span class="kw">table</span>
</pre></div>
<pre><code>##              coef
##  1: -8.509040e-01
##  2:  2.148854e-01
##  3:  1.901724e-01
##  4:  1.672545e-01
##  5:  1.650474e-01
##  6:  1.531422e-01
##  7:  1.510468e-01
##  8:  1.402116e-01
##  9:  1.326720e-01
## 10:  1.321485e-01
## 11:  1.249675e-01
## 12:  1.115810e-01
## 13:  1.114218e-01
## 14:  1.058269e-01
## 15:  9.755956e-02
## 16:  9.358887e-02
## 17:  7.869787e-02
## 18:  7.592093e-02
## 19:  7.429796e-02
## 20:  7.047377e-02
## 21:  6.739943e-02
## 22:  6.696098e-02
## 23:  6.191745e-02
## 24:  6.106494e-02
## 25:  5.956340e-02
## 26:  5.925512e-02
## 27:  5.917987e-02
## 28:  5.909718e-02
## 29:  5.404921e-02
## 30:  4.790203e-02
## 31:  4.695250e-02
## 32:  4.542445e-02
## 33:  4.247331e-02
## 34:  4.069736e-02
## 35:  4.002579e-02
## 36:  3.625673e-02
## 37:  3.592245e-02
## 38:  3.224930e-02
## 39:  3.203616e-02
## 40:  2.771001e-02
## 41:  2.653015e-02
## 42:  2.596375e-02
## 43:  2.559650e-02
## 44:  2.301804e-02
## 45:  2.256363e-02
## 46:  2.048626e-02
## 47:  1.949827e-02
## 48:  1.753155e-02
## 49:  1.373297e-02
## 50:  1.317963e-02
## 51:  1.029828e-02
## 52:  9.586481e-03
## 53:  9.319139e-03
## 54:  8.921289e-03
## 55:  6.506866e-03
## 56:  5.956689e-03
## 57:  4.749919e-03
## 58:  3.716205e-03
## 59:  1.188659e-03
## 60:  4.492954e-04
## 61:  3.206061e-04
## 62:  8.100191e-05
## 63:  6.515244e-05
## 64:  2.994393e-05
## 65:  1.740718e-05
## 66: -1.165468e-02
## 67: -1.663354e-02
## 68: -2.146260e-02
## 69: -9.731628e-02
## 70: -2.042386e-01
## 71: -6.717951e-01
##              coef
##                                                                                   term
##  1:                                                                          Intercept
##  2:                                                                    I(1 &gt;= -0.1725)
##  3:                                                                    I(2 &gt;= -0.1015)
##  4:                                                                     I(1 &gt;= 0.3807)
##  5:                                                                    I(1 &gt;= -0.5685)
##  6:                                                                      I(2 &gt;= 0.119)
##  7:                                                                     I(2 &gt;= 0.6786)
##  8:                                                                     I(1 &gt;= 0.1386)
##  9:                                                                     I(2 &gt;= 1.0291)
## 10:                                                                    I(2 &gt;= -0.6441)
## 11:                                                                     I(1 &gt;= 0.4752)
## 12:                                                                    I(2 &gt;= -0.9482)
## 13:                                                                     I(2 &gt;= -0.782)
## 14:                                                                    I(2 &gt;= -0.9921)
## 15:                                                                     I(2 &gt;= -0.313)
## 16:                                                                    I(1 &gt;= -0.5113)
## 17:                                                      I(1 &gt;= 0.0911)*I(2 &gt;= 0.3539)
## 18:                                                     I(1 &gt;= 0.8989)*I(3 &gt;= -1.0482)
## 19:                                                     I(2 &gt;= 1.2184)*I(3 &gt;= -0.6318)
## 20:                                                      I(1 &gt;= 0.0855)*I(2 &gt;= 0.4067)
## 21:                                                                    I(2 &gt;= -0.6718)
## 22:                                                                      I(1 &gt;= 0.747)
## 23:                                                                    I(1 &gt;= -0.4061)
## 24:                                                                      I(1 &gt;= 0.634)
## 25:                                                                    I(1 &gt;= -0.8398)
## 26:                                                                    I(1 &gt;= -0.2045)
## 27:                                                                    I(2 &gt;= -0.1938)
## 28:                                                                     I(1 &gt;= -0.908)
## 29:                                                                     I(1 &gt;= 0.0345)
## 30:                                                                     I(2 &gt;= 0.1844)
## 31:                                                    I(1 &gt;= -0.1378)*I(3 &gt;= -1.5644)
## 32:                                                                     I(2 &gt;= 0.8281)
## 33:                                                                     I(2 &gt;= 0.3545)
## 34:                                                                     I(2 &gt;= 0.6959)
## 35:                                                                     I(2 &gt;= 0.1737)
## 36:                                                                     I(2 &gt;= 0.0232)
## 37:                                                                     I(2 &gt;= 0.4512)
## 38:                                                                    I(2 &gt;= -0.7863)
## 39:                                                                    I(2 &gt;= -1.2687)
## 40:                                                                     I(2 &gt;= 0.2092)
## 41:                                                                     I(2 &gt;= 0.3237)
## 42:                                                     I(1 &gt;= -0.1388)*I(2 &gt;= 0.9292)
## 43:                                                     I(1 &gt;= 1.1353)*I(3 &gt;= -1.0124)
## 44:                                                                    I(1 &gt;= -0.4766)
## 45:                                                     I(1 &gt;= -0.3937)*I(2 &gt;= -0.782)
## 46:                                                                    I(1 &gt;= -0.3879)
## 47:                                                                     I(2 &gt;= 0.2844)
## 48:                                                     I(1 &gt;= 0.6882)*I(3 &gt;= -0.7632)
## 49:                                                       I(1 &gt;= 0.747)*I(3 &gt;= -1.753)
## 50:                                                     I(1 &gt;= -0.8452)*I(3 &gt;= -0.628)
## 51:                                                                     I(2 &gt;= 0.0444)
## 52:   I(1 &gt;= 1.2006)*I(3 &gt;= -1.011)  OR  I(1 &gt;= 1.2006)*I(2 &gt;= -1.1474)*I(3 &gt;= -1.011)
## 53:                                                                     I(2 &gt;= 1.3571)
## 54:                                                                     I(1 &gt;= 0.1921)
## 55:                                                                     I(1 &gt;= 1.1153)
## 56:                                                     I(2 &gt;= 0.5866)*I(3 &gt;= -0.5114)
## 57:                                                     I(1 &gt;= 1.1153)*I(2 &gt;= -0.3809)
## 58: I(1 &gt;= 1.1072)*I(3 &gt;= -1.4661)  OR  I(1 &gt;= 1.1072)*I(2 &gt;= -1.3281)*I(3 &gt;= -1.4661)
## 59:                                                                    I(1 &gt;= -0.4836)
## 60:                                                                     I(1 &gt;= 0.0954)
## 61:                                                                    I(1 &gt;= -0.3937)
## 62:                                                                     I(1 &gt;= 0.5926)
## 63:                                                                     I(1 &gt;= 0.1884)
## 64:                                                                     I(1 &gt;= 0.1023)
## 65:                                                                     I(2 &gt;= 0.3466)
## 66:                                                                      I(3 &gt;= 0.505)
## 67:                                                                    I(2 &gt;= -2.1828)
## 68:                                                     I(1 &gt;= -2.1579)*I(3 &gt;= 0.3054)
## 69:                                                                     I(2 &gt;= 1.4561)
## 70:                                                                    I(2 &gt;= -2.3508)
## 71:                                                                    I(1 &gt;= -3.0511)
##                                                                                   term</code></pre>
</div>
<div id="obtaining-model-predictions" class="section level3">
<h3 class="hasAnchor">
<a href="#obtaining-model-predictions" class="anchor"></a>Obtaining model predictions</h3>
<div class="sourceCode" id="cb21"><pre class="downlit">
<span class="co"># training sample prediction for HAL vs HAL9000</span>
<span class="kw">mse</span> <span class="op">&lt;-</span> <span class="fu">function</span>(<span class="kw">preds</span>, <span class="kw">y</span>) {
    <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>((<span class="kw">preds</span> <span class="op">-</span> <span class="kw">y</span>)<span class="op">^</span><span class="fl">2</span>)
}

<span class="kw">preds_hal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(object = <span class="kw">hal_fit</span>, new_data = <span class="kw">x</span>)
<span class="kw">mse_hal</span> <span class="op">&lt;-</span> <span class="fu">mse</span>(preds = <span class="kw">preds_hal</span>, y = <span class="kw">y</span>)
<span class="kw">mse_hal</span>
</pre></div>
<pre><code>## [1] 0.02493478</code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit">
<span class="kw">oob_hal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(object = <span class="kw">hal_fit</span>, new_data = <span class="kw">test_x</span>)
<span class="kw">oob_hal_mse</span> <span class="op">&lt;-</span> <span class="fu">mse</span>(preds = <span class="kw">oob_hal</span>, y = <span class="kw">test_y</span>)
<span class="kw">oob_hal_mse</span>
</pre></div>
<pre><code>## [1] 1.543119</code></pre>
<hr>
</div>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references">
<div id="ref-benkeser2016hal">
<p>Benkeser, David, and Mark J van der Laan. 2016. “The Highly Adaptive Lasso Estimator.” In <em>2016 IEEE International Conference on Data Science and Advanced Analytics (DSAA)</em>. IEEE. <a href="https://doi.org/10.1109/dsaa.2016.93">https://doi.org/10.1109/dsaa.2016.93</a>.</p>
</div>
<div id="ref-vdl2017finite">
<p>van der Laan, Mark J. 2017. “Finite Sample Inference for Targeted Learning.” <em>ArXiv E-Prints</em>. <a href="http://arxiv.org/abs/1708.09502">http://arxiv.org/abs/1708.09502</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jeremy Coyle, Nima Hejazi, Mark van der Laan.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
